/*
 * generated by Xtext
 */
package br.usp.icmc.amenu.validation

import org.eclipse.xtext.validation.Check
import br.usp.icmc.amenu.aMenu.Menu
import java.util.HashMap
import br.usp.icmc.amenu.aMenu.Item
import org.eclipse.emf.ecore.EObject
import br.usp.icmc.amenu.aMenu.AMenuPackage

//import org.eclipse.xtext.validation.Check

/**
 * Custom validation rules. 
 *
 * see http://www.eclipse.org/Xtext/documentation.html#validation
 */
class AMenuValidator extends AbstractAMenuValidator {
	
	  public static val DUPLICATE_NAME = 'duplicateName'

	@Check
	def checkIdAreUnique(Menu menu) {
		 var map = new HashMap<String, EObject>
		 
		 //ID Menu
		 if (map.containsKey(menu.name)) {
			error('ID names must be unique', 
				menu,
				AMenuPackage.Literals.MENU__NAME,
				DUPLICATE_NAME)
			error('ID names must be unique', 
				map.get(menu.name),
				AMenuPackage.Literals.MENU__NAME,
				DUPLICATE_NAME)
		}else{
			if(!menu.name.equals('')  && menu.name != null){
				map.put(menu.name, menu);
			}
		}
		 
		 
		 // ID Items
		 for (Item m : menu.items){
			if (map.containsKey(m.name)) {
				error('ID names must be unique', 
					m,
					AMenuPackage.Literals.ITEM__NAME,
					DUPLICATE_NAME)
				error('ID names must be unique', 
					map.get(m.name),
					AMenuPackage.Literals.ITEM__NAME,
					DUPLICATE_NAME)
			}else{
				if(!m.name.equals('') && m.name != null){
					map.put(m.name, m);
				}
				
				// ID images
				if (map.containsKey(m.icon.name)) {
					error('ID Names must be unique', 
						m.icon,
						AMenuPackage.Literals.ICON__NAME,
						DUPLICATE_NAME)
					error('ID names must be unique', 
						map.get(m.icon.name),
						AMenuPackage.Literals.ICON__NAME,
						DUPLICATE_NAME)
				}else{
					if(!m.icon.name.equals('')  && m.icon.name != null){
						map.put(m.icon.name, m.icon);
					}
				}	
			}
		}
		
		
	}

//  public static val INVALID_NAME = 'invalidName'
//
//	@Check
//	def checkGreetingStartsWithCapital(Greeting greeting) {
//		if (!Character.isUpperCase(greeting.name.charAt(0))) {
//			warning('Name should start with a capital', 
//					MyDslPackage.Literals.GREETING__NAME,
//					INVALID_NAME)
//		}
//	}
}
